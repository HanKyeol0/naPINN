# --- run experiment ---
# scripts/mlp/navierstokes2d_cylinder.sh
# scripts/mlp/z_navierstokes2d_cylinder_fore.sh

# --- run simulation ---
# scripts/simulation/navierstokes_cylinder_1.sh
# scripts/simulation/navierstokes_cylinder_2.sh

tag: naPINN_1
device: cuda

simulation_tag: ns_data_3
dir_path: pinnlab/simulation/simulation_result/

# --- Simulation config ---
domain:
  x: [0.0, 2.0]
  y: [0.0, 1.0]
  burn_in_time: 14
  record_time: 4

simulation_points:
  nx: 200
  ny: 100
  dt: 0.002
  every: 20

grid:
  nx: 200
  ny: 100
  dt: 0.002

# simulation 1
cylinder:
  x: 0.3
  y: 0.5
  r: 0.12

# simulation 2
obstacles:
  - {x: 0.3, y: 0.5, r: 0.12}   # First cylinder
  # - {x: 0.8, y: 0.7, r: 0.1}   # Second cylinder

n_collocation:
  nx: 200
  ny: 100
  nt: 100
n_measurement: 5000

# Fluid params
nu: 0.001        # kinematic viscosity
rho: 1.0         # density
U0: 1.0          # initial velocity amplitude
k: 1.0           # wavenumber

# --- Experiment config---

# Loss weights inside PDE residual (you can tune)
weights:
  continuity: 1.0
  momentum: 1.0

# Model I/O
in_features: 3   # (x,y,t)
out_features: 3  # (u,v,p)

# sampling
sampling_mode: grid # random / grid
batch:
  n_f: 3000

# noise
noise:
  enabled: true
  batch_size: 2000
  kind: G # G, Goff, sG, u, 3G, 3G0, mix0, Gmix, rmix, sGtest
  
  scale: 0.1 # legacy
  # relative_scale: 0.10  # 10% relative error proportional to velocity
  # floor_scale: 0.01     # 1% of global mean as minimum noise floor

  extra_noise:
    enabled: true
    n_points: 1000
    scale_min: 30.0
    scale_max: 100.0

# phase
phase:
  enabled: true # true / false
  phase1_epochs: 20000
  phase2_epochs: 30000

ebm:
  enabled: true
  kind: 1D # 1D / 2D
  hidden_dim: 32
  depth: 4
  num_grid: 256
  max_range_factor: 2.5
  lr: 1.0e-3
  use_nll: false
  init_train_epochs: 5000

data_loss:
  kind: mse # mse, L1, q_gaussian
  # q-Gaussian settings
  q: 2.0
  beta: null

data_loss_balancer:
  use_loss_balancer: true # true / false
  kind: gated_trainable # pw, inverse, mlp, gated, gated_trainable
  weight_net:
    hidden_dim: 32
    depth: 3

offset:
  enabled: false
  init: 0.0

# video
video:
  enabled: true
  every: 10000
  grid:
    nx: 120
    ny: 120
    nt: 80
  fps: 10
  format: mp4